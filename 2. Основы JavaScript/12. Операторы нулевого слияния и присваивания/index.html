<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Операторы нулевого слияния и присваивания: «??», «??=»</title>
    <link href="../../style.css" type="text/css" rel="stylesheet">
</head>
<body>
    <article>
        <h2>Оператор нулевого слияния (??)</h2>
        <p>Оператор нулевого слияния представляет собой два вопросительных знака <code>??</code>.</p>
        <p>Так как он обрабатывает <code>null</code> и <code>undefined</code> одинаковым образом, для краткости будем говорить,
        что значение «определено», если оно не равняется ни <code>null</code>, ни <code>undefined</code>.</p>
        <p>Результат выражения <code>a ?? b</code> будет следующим:</p>
        <ul>
            <li>Если <code>a</code> определено, то <code>a</code>;</li>
            <li>Если <code>a</code> не определено, то <code>b</code>.</li>
        </ul>
        <p>Иначе говоря, оператор <code>??</code> возвращает первый аргумент, если он не <code>null/undefined</code>, иначе
        второй.</p>
        <p>Вот так можно переписать выражение <code>let result = a ?? b;</code>, используя уже знакомые нам операторы:</p>
        <code>let result = (a !== null && a !== undefined) ? a : b;</code>
        <p>Как правило, оператор <code>??</code> нужен для того, чтобы задать значение по умолчанию для потенциально
        неопределенной переменной.</p>
        <p>Кроме того, можно записать последовательность из операторов <code>??</code>, чтобы получить первое значение из
        списка, которое не является <code>null/undefined</code>.</p>
        <p>Допустим, у нас есть данные пользователя в переменных <code>first_name</code>, <code>last_name</code> и
        <code>nickname</code>. Все они могут не существовать, если пользователь решил не вводить соответствующие значения.</p>
        <p>Мы хотели бы отобразить имя пользователя, используя одну из этих переменных, или показать «Аноним», если все
        они <code>null/undefined</code>.</p>
        <p>Для этого воспользуемся оператором <code>??</code>:</p>
        <code>let first_name = null;</code><br>
        <code>let last_name = null;</code><br>
        <code>let nickname = 'Суперкодер';</code><br>
        <code>alert(first_name ?? last_name ?? nickname ?? 'Аноним');</code> // 'Суперкодер'
    </article>

    <article>
        <h2>Сравнение с ||</h2>
        <p>Оператор ИЛИ <code>||</code> можно использовать для того же, что и <code>??</code>.</p>
        <p>Например, если в приведенном выше коде заменить <code>??</code> на <code>||</code>, то будет тот же самый результат.</p>
        <p>Исторически сложилось так, что оператор ИЛИ <code>||</code> появился первым. Он существует с самого начала в
        JavaScript, поэтому разработчики долгое время использовали его для таких целей.</p>
        <p>С другой стороны, сравнительно недавно в язык был добавлен оператор нулевого слияния <code>??</code> - как раз
        потому, что многие были недовольны оператором <code>||</code>.</p>
        <p>Важное различие между ними заключается в том, что:</p>
        <ul>
            <li><code>||</code> возвращает первое <i>истинное</i> значение;</li>
            <li><code>??</code> возвращает первое <i>определенное</i> значение.</li>
        </ul>
        <p>Проще говоря, оператор <code>||</code> не различает <code>false</code>, <code>0</code>, пустую строку <code>''</code> и
        <code>null/undefined</code>. Для него они все одинаковые, т.е. являются ложными значениями.</p>
        <p>Однако на практике часто требуется использовать значение по умолчанию только тогда, когда переменная является
        <code>null/undefined</code>. Ведь именно тогда значение действительно неизвестно/не определено.</p>
    </article>

    <article>
        <h2>Приоритет</h2>
        <p>Приоритет оператора <code>??</code> такой же, как и у <code>||</code>. Оба они равны 3.</p>
        <p>Это означает, что как и <code>||</code>, оператор нулевого слияния <code>??</code> вычисляется до <code>=</code> и
        <code>?</code>, но после большинства других операций, таких как <code>+</code>, <code>*</code>.</p>
    </article>

    <article>
        <h2>Использование ?? вместе с && или ||</h2>
        <p>По соображениям безопасности JavaScript запрещает использование оператора <code>??</code> вместе с
        <code>&&</code> и <code>||</code>, если приоритет явно не указан при помощи круглых скобок.</p>
        <p>Выполнение следующего кода приведет к синтаксической ошибке:</p>
        <code>let x = 1 && 2 ?? 3;</code> // Синтаксическая ошибка
        <p>Используйте скобки, чтобы обойти это ограничение:</p>
        <code>let x = (1 && 2) ?? 3;</code> // Работает без ошибок
    </article>

    <article>
        <h2>Оператор нулевого присваивания (??=)</h2>
        <p>Предположим, нам необходимо проверить, равно ли переменная <code>null</code> или <code>undefined</code>, и если
        это так - присвоить этой переменной какое-либо значение.</p>
        <code>x ??= y;</code>
        <p>Оператор <code>??=</code> присвоит <code>x</code> значение <code>y</code> только в том случае, если <code>x</code>
        <i>не определено</i> (<code>null/undefined</code>).</p>
    </article>

    <article>
        <h2>Итого</h2>
        <ul>
            <li>
                <p>Оператор <code>??</code> - это быстрый способ выбрать первое «определенное» значение из списка.</p>
                <p>Используется для присвоения переменным значений по умолчанию.</p>
            </li>
            <li>Оператор <code>??</code> имеет очень низкий приоритет, лишь немного выше, чем у <code>?</code> и <code>=</code>,
            поэтому при использовании его в выражении, скорее всего, потребуются скобки.</li>
            <li>Запрещено использовать вместе с <code>||</code> или <code>&&</code> без явно указанного приоритета, то есть
            без скобок.</li>
            <li>Для присвоения переменной значения в зависимости от того, «определена» она или нет, используется оператор
            нулевого присваивания <code>??=</code>.</li>
        </ul>
    </article>
</body>
</html>