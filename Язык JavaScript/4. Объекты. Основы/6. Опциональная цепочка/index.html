<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Опциональная цепочка «?.»</title>
    <link href="../../../style.css" type="text/css" rel="stylesheet">
</head>
<body>
    <article>
        <h2>Опциональная цепочка «?.»</h2>
        <p>Опциональная цепочка <code>?.</code> - это безопасный способ доступа к свойствам вложенных объектов,
        даже если какое-то из промежуточных свойств не существует.</p>
    </article>

    <article>
        <h2>Опциональная цепочка</h2>
        <p>Опциональная цепочка <code>?.</code> останавливает вычисление и возвращает <code>undefined</code>, если значение
        перед <code>?.</code> равно <code>undefined</code> или <code>null</code>.</p>
        <p><b>Далее в этой статье, для краткости, мы будем говорить, что что-то «существует», если оно не является
        <code>null</code> или <code>undefined</code>.</b></p>
        <p>Другими словами, <code>value?.prop:</code></p>
        <ul>
            <li>Работает как <code>value.prop</code>, если значение <code>value</code> существует.</li>
            <li>В противном случае (когда <code>value</code> равно <code>undefined/null</code>) он возвращает <code>undefined</code>.</li>
        </ul>
        <p>Синтаксис <code>?.</code> делает необязательным значение перед ним, но не какое-либо последующее.</p>
        <p>Так например, в записи <code>user?.address.street.name</code> <code>?.</code> позволяет <code>user</code>
        безопасно быть <code>null/undefined</code> (и в этом случае возвращает <code>undefined</code>), но это так только
        для <code>user</code>. Доступ к последующим свойствам осуществляется обычным способом. Если мы хотим, чтобы некоторые из
        них были необязательными, тогда нам нужно будет заменить больше <code>.</code> на <code>?.</code>.</p>

        <article class="warning">
            <h2>Не злоупотребляйте опциональной цепочкой</h2>
            <p>Нам следует использовать <code>?.</code> только там, где нормально, что чего-то не существует.</p>
            <p>К примеру, если, в соответствии с логикой нашего кода, объект <code>user</code> должен существовать, но
            <code>address</code> является необязательным, то нам следует писать <code>user.address?.street</code>, но не
            <code>user?.address?.street</code>.</p>
            <p>В этом случае, если вдруг <code>user</code> окажется <code>undefined</code>, мы увидим программную ошибку
            по этому поводу и исправим ее. В противном случае, если слишком часто использовать <code>?.</code>, ошибки
            могут замалчивать там, где это неуместно, и их будет сложнее отлаживать.</p>
        </article>

        <article class="warning">
            <h2>Переменная перед <code>?.</code> должна быть объявлена</h2>
            <p>Если переменной <code>user</code> вообще нет, то <code>user?.anything</code> приведет к ошибке.</p>
            <p>Переменная должна быть объявлена (к примеру, как <code>let/const/var user</code> или как параметр функции).
            Опциональная цепочка работает только с объявленными переменными.</p>
        </article>
    </article>

    <article>
        <h2>Сокращенное вычисление</h2>
        <p><code>?.</code> немедленно останавливает вычисление, если левая часть не существует.</p>
        <p>Так что если после <code>?.</code> есть какие-то вызовы функций или операции, то они не произойдут.</p>
    </article>

    <article>
        <h2>Другие варианты применения: ?.(), ?.[]</h2>
        <p>Опциональная цепочка <code>?.</code> - это не оператор, а специальная синтаксическая конструкция, которая также
        работает с функциями и квадратными скобками.</p>
        <p>Например, <code>?.</code> используется для вызова функции, которая может не существовать.</p>
        <p>В приведенном ниже коде у некоторых наших пользователей есть метод <code>admin</code>, а у некоторых его нет:</p>
        <code>
            let userAdmin = {<br>
            &nbsp;&nbsp;admin() {<br>
            &nbsp;&nbsp;&nbsp;&nbsp;alert('Я админ');<br>
            &nbsp;&nbsp;};<br>
            <br>
            let userGuest = {};<br>
            <br>
            userAdmin.admin?.(); // Я админ<br>
            userGuest.admin?.(); // Ничего не произойдет
        </code>
        <p>Здесь в обеих строках мы сначала используем точку (<code>userAdmin.admin</code>), чтобы получить свойство
        <code>admin</code>, потому что мы предполагаем, что объект <code>userAdmin</code> существует, так что читать
        из него безопасно.</p>
        <p>Затем <code>?.()</code> проверяет левую часть: если функция <code>admin</code> существует, то она запускается.
        В противном случае вычисление остановится без ошибок.</p>
        <p>Синтаксис <code>?.[]</code> также работает, если мы хотим использовать скобки <code>[]</code> для доступа к свойствам
        вместо точки <code>.</code>. Как в предыдущих случаях, он позволяет безопасно считывать свойство из объекта,
        который может не существовать.</p>
        <code>
            let key = 'first_name';<br>
            <br>
            let user1 = {<br>
            &nbsp;&nbsp;firstname: 'John';<br>
            };<br>
            <br>
            let user2 = null;<br>
            <br>
            alert(user1?.[key]); // John<br>
            alert(user2?.[key]); // undefined
        </code>
        <p>Также мы можем использовать <code>?.</code> с <code>delete</code>:</p>
        <code>delete user?.name; // Удаляет user.name если пользователь существует</code>

        <article class="warning">
            <h2>Мы можем использовать <code>?.</code> для безопасного чтения и удаления, но не для записи</h2>
            <p>Опциональная цепочка <code>?.</code> не имеет смысла в левой части присваивания.</p>
            <p>Например:</p>
            <code>
                let user = null;<br>
                user?.name = 'John'; // Ошибка. Тоже самое, что написать undefined = 'John'
            </code>
        </article>
    </article>

    <article>
        <h2>Итого</h2>
        <p>Синтаксис опциональной цепочки <code>?.</code> имеет три формы:</p>
        <ol>
            <li><code>obj?.prop</code> - возвращает <code>obj.prop</code> если <code>obj</code> существует, в противном
            случае <code>undefined</code>.</li>
            <li><code>obj?.[prop]</code> - возвращает <code>obj[prop]</code> если <code>obj</code> существует, в противном
            случае <code>undefined</code>.</li>
            <li><code>obj.method?.()</code> - вызывает <code>obj.method()</code>, если <code>obj.method</code> существует,
            в противном случае возвращает <code>undefined</code>.</li>
        </ol>
        <p>Как мы видим, все они просты и понятны в использовании. <code>?.</code> проверяет левую часть на
        <code>null/undefined</code> и позволяет продолжить вычисление, если это не так.</p>
        <p>Цепочка <code>?.</code> позволяет безопасно получать доступ к вложенным свойствам.</p>
        <p>Тем не менее мы должны использовать <code>?.</code> осторожно, только там, где по логике кода допустимо,
        что левая часть не существует. Чтобы он не скрывал от нас ошибки программирования, если они возникнут.</p>
    </article>
</body>
</html>